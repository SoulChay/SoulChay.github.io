<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>22</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-05-11T06:29:25.113Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Soulchay</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Encrypt的目录bug</title>
    <link href="http://example.com/2022/05/10/Encrypt%E7%9A%84%E7%9B%AE%E5%BD%95bug/"/>
    <id>http://example.com/2022/05/10/Encrypt%E7%9A%84%E7%9B%AE%E5%BD%95bug/</id>
    <published>2022-05-10T07:08:00.000Z</published>
    <updated>2022-05-11T06:29:25.113Z</updated>
    
    <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>起初是不想搞博文加密的，奈何博客地址不小心泄露给表妹，于是决定还是要折腾一下这个博文加密。</p><p>（😎 ：表妹啊，你就别想敲诈我了！）</p><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-blog-encrypt</span><br></pre></td></tr></table></figure><h3 id="加密文章"><a href="#加密文章" class="headerlink" title="加密文章"></a>加密文章</h3><p>①：在想要加密的博文头部增添 <code>password</code> , <code>abstract</code> , <code>message</code> 字段即可，三个字段可加可不加，不加则采用 <code>_config.yml</code> 配置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Test encrypt</span><br><span class="line">date: 2022-05-09 15:08:00 </span><br><span class="line">tags:</span><br><span class="line">- Java</span><br><span class="line">password: hello</span><br><span class="line">abstract: Welcome to my blog, enter password to read. //博客部分摘要</span><br><span class="line">message: Welcome to my blog, enter password to read.  //密码输入框上面的描述性文字</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>②：在<strong>博客根目录</strong> 的<code>_config.yml</code>中添加配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Security</span></span><br><span class="line"><span class="attr">encrypt:</span></span><br><span class="line">  <span class="attr">silent:</span> <span class="literal">true</span> <span class="comment">#禁用日志</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">xray</span>  <span class="comment">#加密的主题（不是hexo主题，可到 github 上 probberechts/hexo-theme-cactus 的 readme.md 查看 ）</span></span><br><span class="line">  <span class="attr">abstract:</span> <span class="string">Please</span> <span class="string">enter</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read</span> <span class="comment">#博客部分摘要</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">Please</span> <span class="string">enter</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read</span>  <span class="comment">#密码输入框上面的描述性文字</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tagName</span>, <span class="attr">password:</span> <span class="string">密码A</span>&#125;</span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tagName</span>, <span class="attr">password:</span> <span class="string">密码B</span>&#125;</span><br><span class="line">  <span class="attr">wrong_pass_message:</span> <span class="literal">no</span> <span class="string">Permissions.</span>  <span class="comment">#密码错误提示</span></span><br><span class="line">  <span class="attr">wrong_hash_message:</span> <span class="string">can</span> <span class="string">not</span> <span class="string">Verify.</span>  <span class="comment">#哈希错误提示</span></span><br></pre></td></tr></table></figure><p>③：<strong>配置优先级</strong>：博文头部配置 &gt; yml文件配置 &gt; 默认配置</p><p>④：若想禁用标签<code>(tag)</code>加密，只需将<code>password</code>属性设置为<code>&quot;&quot;</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Callback Test</span><br><span class="line">date: 2019-12-21 11:54:07</span><br><span class="line">tags:</span><br><span class="line">- A Tag should be encrypted</span><br><span class="line">password: &quot;&quot;</span><br><span class="line">---</span><br><span class="line">Use a &quot;&quot; to disable tag encryption.</span><br></pre></td></tr></table></figure><p>⑤：加密成功演示：</p><ul><li><p>新建一个 <code>markdown</code> 文档并推送到 github ，内容如下。</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/1.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>被加密后的博文界面</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/2.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>输入密码并回车</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/3.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>内容显示成功，并且可以点击 <code>Encrypt again</code> 按钮回到加密界面</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/4.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><h3 id="Bug"><a href="#Bug" class="headerlink" title="Bug!"></a>Bug!</h3><p>当我在为成功实现博文加密功能沾沾自喜（😃）时，突然发现一个问题，<strong>哎我目录呢？！</strong>（ 🤡 ）</p><h3 id="分析Bug"><a href="#分析Bug" class="headerlink" title="分析Bug"></a>分析Bug</h3><p>①：检查目录对应代码，发现解密前后目录标签里面什么都没有</p><ul><li><p>解密前界面</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/5.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>解密后界面</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/6.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><p>②：因为本人前端部分只能算是小菜鸡，只能用最笨的办法根据标签id去文件里去找了。</p><p>因为是文章部分，所以直接定位到 <code>_partial\post</code>  的各个<code>ejs</code>文件，寻找的方法很简单，<code>CTRL + F</code> 搜索 <code>toc</code> 即可。</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/7.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>③：最终发现 <code>toc</code> 在 <code>actions_desktop.ejs</code> 和 <code>actions_mobile.ejs</code>中出现。见名知意，一个是pc端一个是移动端呗。</p><p>以 pc端为例分析：</p><ul><li><p>发现只有一处地方出现了 <code>toc</code></p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/8.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>而经查略 <a href="https://github.com/D0n9X1n/hexo-blog-encrypt/issues/16">issue</a>，了解到TOC的加载原理是：</p><ul><li>在执行 <code>hexo g</code> 时会按照博文内容生成 TOC，然后默认隐藏不出现。</li><li>在<code>Encrypt</code> 对文章进行加密时，<code>page.content</code> 会变成加密后的串，所以原来 TOC 生成逻辑就会针对加密后的内容。</li></ul></li></ul><p>（🤔）</p><h3 id="解决Bug"><a href="#解决Bug" class="headerlink" title="解决Bug"></a>解决Bug</h3><p>①：原理了解后就可以动手解决Bug了</p><ol><li>可以把文章原来的内容先保存起来，比如保存进 <code>page.origin</code> 字段</li><li>然后可以判断文章是否加密，针对不同的内容进行 TOC 生成。</li><li>但是生成的 TOC 是基于原文的，所以默认隐藏，需要输入密码后才能显示出来</li></ol><p>②：动手解决Bug</p><ul><li><p>pc端（actions_desktop.ejs）：</p><p>原代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc&quot;</span>&gt;</span></span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改后：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc&quot;</span> &lt;% <span class="attr">if</span> (<span class="attr">page.encrypt</span> == <span class="string">true)</span> &#123; %&gt;</span>style=&quot;display:none&quot; &lt;% &#125; %&gt;&gt;</span><br><span class="line">&lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.origin) %&gt;</span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>移动端（actions_mobile.ejs ）</p><p>原代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第一次修改：</p><p>​<b>不起作用，这是因为在每次加载页面时，如果判断当前是移动端，会有js代码帮我们把 <code>style=&quot;display:none&quot;</code> 修改为<code>style=&quot;display:inline&quot;</code></b>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span> </span><br><span class="line">&lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.origin) %&gt;</span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二次修改：</p><p>​<b>知道原因后就简单了，在里面套一个 <code>&lt;div&gt;</code> 标签不就得嘞（😄）</b></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer2&quot;</span> &lt;% <span class="attr">if</span> (<span class="attr">page.encrypt</span> == <span class="string">true)</span> &#123; %&gt;</span>style=&quot;display:none&quot; &lt;% &#125; %&gt;&gt;</span><br><span class="line">       &lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">         &lt;%- toc(page.origin) %&gt;</span><br><span class="line">       &lt;% &#125; else &#123; %&gt;</span><br><span class="line">         &lt;%- toc(page.content) %&gt;</span><br><span class="line">       &lt;% &#125; %&gt;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>③：还差最后一步，每次从 加密状态 -&gt;解密状态 进行切换时，都需要我们自己调用函数，将<code>style=&quot;display: none&quot;</code>修改为<code>style=&quot;display: inline&quot;</code>，确实有点麻烦哈（参考于<a href="https://github.com/D0n9X1n/hexo-blog-encrypt#about-callback">官方</a>的<code>Callback</code>）。</p><p>在需要加密的文章最后加入以下js代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>).<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc-footer2&quot;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc-footer2&quot;</span>).<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;  </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/9.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>④：最终测试</p><ul><li><p>pc端未解密界面：没有目录</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/10.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>pc端解密后界面：出现目录</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/11.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>移动端未解密界面：没有目录</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/12.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>移动端解密后界面：出现目录</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/bk/encrypt/13.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><p>（😎）</p><h3 id="End"><a href="#End" class="headerlink" title="End"></a>End</h3><p>（🤺：本人在前端部分只能算是小菜鸡，若有错误，欢迎指正。）</p><p>（😭：还有就是使用cactus主题的前辈们实在太少了，想懒人大法都找不着C的地方。不过这次扒代码，还是很有某种收获吧！）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h3&gt;&lt;p&gt;起初是不想搞博文加密的，奈何博客地址不小心泄露给表妹，于是决定还是要折腾一下这个博文加密。&lt;/p&gt;
&lt;p&gt;（😎 ：表妹啊，</summary>
      
    
    
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
    <category term="Bug" scheme="http://example.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>encrypt Test</title>
    <link href="http://example.com/2022/05/10/test/"/>
    <id>http://example.com/2022/05/10/test/</id>
    <published>2022-05-10T07:08:00.000Z</published>
    <updated>2022-05-14T01:29:56.254Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="no Permissions." data-whm="can not Verify.">  <script id="hbeData" type="hbeData" data-hmacdigest="25d0b7516b7a8f14dc16ca05e2951e302e210bc5268953ae7852604c2a99184e">20ca77dbbd47f75fc977c3df15668b7eee2d8def7185dd085c398e8605efcfcfe747e3faf24aab40142bfd3ffaf987a196eed27a60b626cd414eb40307dafe5dcba6e5fb8cf466cb986bca5da7f5b49d7be9ca3695d81b1bea6f31cdc4a9ee86267dbd92097af7122d598a0cd1c8688372fb5240b02476e2feaad05065787a5bc44f2833c6c8b89b7abf003a694e90812308de73d35a6f5bce5098d246d29b9f1cbfddbaba8af2fddf3107e4897eb2c9cca3830af2e8d6df03c53b3d02089a19edb31193ee9a89142c5f0e66ad969129dcadc15f5ffadd20a37a1d12304e446868be394e9c71c410a9be12bc70f3cafa2f89288e692c2b9d0759e591cc6cb0a8b9318882ce84688a06a2190edbc4c9739c42efcf34d74af0e4aa64e5e1e7df17e395696145162a7be6b885a009fc632b4834fe3e439cfb3cbbe05303aeba40ced538dd659c71b26b7c35f8fecae39f3209c0ac2e3c372e6e80298d4a45c1a7bf8f8fa3e58de4299aa0bf6be847deb001a57e27c9cbd77ff8ed3fcdbe62310f285dd26f0275f02bc2259d00e0b113997ff27414746fd16ba6d8be322c484da4db67aa6b24fcba1dd6bf24bd486288c2784eead4b767458c43c2f8039b3d98b7e2c537185f0899f05724978c268b6f21a78ec18904928341fddad8e2d3600de39d53cef470f01ae5608c89f87ccbf76fc3011d94e7053d7e8f24a39b55dc54f5851b1b477824d51e5c9b333bc6aa694454b26a118be8aad313efc96217b07ad59354046aaec6de73eb0357b6832d492550e101aae1b49c2df0b715eeae86a21ef3d166551ea6adb34b6e67c2eee6fd34108418a5f938a90f5c74f28cc468ba3f7b72e55aa4886ac40af5b4fb04ead8a1be8183bb55ae8cbc2ecc57444266e2cd7ea5a941676ff7a10ee3d857b75fc22d395b74dbf03e4362f81cd53b389c3e4a97ea95e78587d7be4872abb805b2594289d5a9782672d55feee3fc8c785dfb37f8bceaf3b6b205d68e86f55da52171f5370ef96dfaad2619d89c7c15e8f4c974eaeb92e54185491a333991d3292e6014d970de7c999f2029494f2b99020093aae9fbf6b47547e3670ce74e76398c32ba35bf861fefbd2809b78c334fbce996b3db00cea046ee7da278ebd2c384899d9b5c24d0895cfd773d1b04597ea1326e8f9880d81a9fa5da565efd5efc64554180801762bc4943817864d3db0d339a8c1359ba5498deed6ea3e6fe6c37341437b0070e8298cc2a6250ca1779a029775beb46b07e62761df4b7d733f5abe09622adb88753d11145059b74f2ace2fca41e1c7f471f99c1fdcf434f53e556f85c6d96a4706da86f207eb2ce7de84dc73a8399e660ba9ca5002c461badb5c042accae579215a4f8be901330acd928269e2fd3e74a025f7b0535dd7f3abe4d4b6895df3ea9710c9b09cfe3e937cef01ac59dad52442e0e9f9937ea9698c51f78cec4d7daacb4d1f11827f32efa639ba0b1543bb77232f2ab55ef4d98d8876fc4b8db8dadd12d0d2d7c1f43e0b0a4dbcdf49267d49bcdd95b12fd01d7c94c149932690749cedd6a319ae4edb41a44b6bfe3c70a53126f5d30998953553f2abde5501bf1dacad2d6d9ca7aa956d86883c414a61dbdcafdf97d3c628889038fce64117aa9181dff947750ff52a8fcf6db25b506f6b5534f1d21c99d602b6433d5c28c5778aa66602b041268b052519029efde8d5d59c9a72e5cf60399dc2778a05efbdc9467260c35b7baed3b1dcff02078157108e6798cf6f5c6fb9041e69f763264cd551edf64a1c9cd78a25f97ccf7ea6d8958a2b4f1dee6c949af783794734648e953fe8a432765d66ff1332ba38ab5f54392ecc99ba6b0e4ca7dd9740a599be93c8a00357cb8bb839f96a690421f9fb6ee0b4ed6441e6e17443b67e539ca9eed01142d4569202cc26bb6b87342823b0596c1b19f60d861aa274350a12987b1e7ffa83bcce9f812bdeda224f4874e3a2a6d421f005c6fdcac23cdb8276cd31f54e280c054bd11d73ee884b2d9c2e675bd910df1e86f238a296a23064af344bb4b5686bc2c78fe8b5a57c5a034250211896e0b379da25bcc8dc1cccceadf71b4c9ad3fe8ee4f7c4093fe9107d0f8e0eb4e8255473032e7261ced7c0905e000de8bc2129cf2c0ab7f68a5fe0953768b7fedd622c998884cf79d441543602f607c560a9a1ca9ecb25a6a743e6df6c76e15ef1656c8c5065671f6b76e9c39ecb964073408e8b680de5cec7dbd866ebe25ec8b848b34ab871e96363ca7a6dc57bf65c774e4f5d1d5fe2ea442ab2d5f288e8e78b316e377306b085d599b30018cc2f29cb0858fddf41f5ba68c133f3285512739a2517b3b043a83a441dc69938bfb86fec262a44404f6d08b824bee73df83bea3fb4acc3d502ce0f543c4d9d9b18becbbbb02c402f1f249a524e55ad1e610117eb4a764b6066258c2ecd7b7dd2e1a203f7a21f43246c504532f738f7eab51daf5f8bfe642c8c3d9f1c2ff2f93dbe15ac249fa30cd81f5f988a9a25b140d4fda7e65c6d37ff4b5a96753f2b0e214530701ebb94cfdfedf8d7508dd3dfcd0e13871bc63bb40a1866d19c5f0bc873d580a4363c253d1a86b04ffbd3387f93490ccffba4e12c5be965ed322c2dccb1cf9683df5d49af3790a4c31d28c098675a07a2fa32ecc13e37bc7f8e89d0a63986d59f39d4881cd1606caa1996320f1540059791593e92fc3d1d5177461172ffb61ce6bb978cb91269fbdc0faf0007e6a9a5a819b9ef3cca0223abe2a0d2ce2023a3c7b100b5ddcf64b281f62c498cd080f19557c8cf3ac909d36aab7ab9c78cc9ef17c59f324bacdd72ba9661297d19bfe8bbb48135317c558cfa2c84e37a4cce8f84b75ab37ffcb738e0524e43c54af976986dbcc52de758a0834217c14c4aeb1a5a1c77dcba4521319e69397b089e01ed3085f04993e71e6c02f4e720f64c763930c8e310c83e79c707eb2cc2e696b7c53a48b45e324c982e807f3addd39e54a2480e4add7a294468bee687fe3380b358f5a8432795cb5849cf9e4c5f421c4c852a0e935b106ec482d96abafef1b464afe1141ae97ce78fab0873b5cbfb7a59d5bd337b5317dd4a3d7be744a3565ea6241cde2075662cb9078294510ac22cbe0c2125591aa0612f8e5105d9c387d8c62322fc7a97759807655f14f539df0dce662ac87c53b485c8a800a0786ecd87b278e2cc057909ba580b40d4cb6957a72b9f302c1ed6c2c4b0070188a9874019c411e4ca833dfcafd482990593ea24738963518eeb9c0a304338c1f82b485fe1ffec13a47528d9528a1d5902ee9aa68aabe28e943f1ebf4f363af8ac4f3995f9954f653f1d0e5a1e901a0f528decd4c4209cb4dd7eb94a2f6d04eb00c48e20255c259e291909b8aa488d0c708080e01e7464ed829c326038c1eb13e19f85ef4eb7fd2f34c295a10c1cd611514d3fe09ec29effcd76c784c74d3151d7ab1e2a2225b1e798469b069367e1e1e916d4f1d7593ec4ac976f37ca6bde4cba3818b1c33feaf20450963d9e4e5e1212510aa174a9f363c80a763326beadb2b39488b39a880abcf3a94226b7687e9c442ece680e21325df850859c276bae04d7585823030a81a0ee53fce23ca5523e532911d7ae528b21e130d10caa89e29cb6a5f311756220a1d318415bf998ade728a94e917e74456549acedbdcc2dc07462c032b611d08c9f5df92ceda0c2a4f019e2537b515892a800085dac6b2017de9e18a2c9c72b3eaa9e10854a1eb109d7f54ae6d3a06861abf4720b95466d2b7cec1d7c9df1283c4ca89eafcd489229b575cc623eb7e38cf22a241fcb03a517f55071418b65893a5dc3fed859f9c2f0561d88515ddb56aa387fda58abff4000438d97263cfa54725c1cba31a522cee4367146f0886fceb0c725d20eaa0a0bb84392e3d195932fbda82c11f6d7e1a5a39f257099bdc74e515ec4fddce259f7ea4f8393f2ec6241e1f9784eba3b1ecdbede83e0611f7609f1fbb35ca5aa54e894f5ca36dc2e48e3831843dc4d1be1d41ecd5a3b42cda0085010c2d0d187b5acbd8768c8ce26759dbac0ac970ab7acc7f8f8af2f9b8f575457752089e4865cd72c618841c5c9e6ee1e1c07050d4420b397ea124a68e0138dc6e2272e12673bd00dadd10706f898742f1ca4a78f07737c6788b1bd0e81ef5286e60f62ba136fa3aec1807d82c21ed06d5218731ac1fcc55eecc917af8147d4b97844cb5dec2b6db2f463c0e6e604cf2d22048cbde3b6c3f814a6a5d2a4fb9c19f7ac021f477d080a6f7aab02c430f549dc66bde4cf3ccdd6601a48c0c9755128e80ac1b3d5e4caa41d835859db25646a4fa4c081f7fd37802ea1ad3871135fcf2ed912bf856190c142893e0fea514de8a1d123c3f6d4ad66089858aa2789b9b8c6bacea2bc8b8744709120593e106a18ca7090534d6acc0e5dd3d81c00c551d0362fb6ef48e1ba0bd2b8517e8d0d61bb68ff8a2ee2762f087925b99a6c7d6b562649e04c4455b1cfc4d8c7c3afd6d7e88b4b5be7e4ed9778e125f9b91a7c1376e4f0ed35c7b6d0ccd20e8db014b810c066deb940cfa141eb5d9d0a9d5b12a50729bc528c42dbe893b458c5368e5dd5d7c1392ddc131414b89200fa711fe75cfac1d3883ec7d9e783e8f32787a2d191b3960cfb264682ceb9ab93dcc650d2a617d1ee5a6d131dab0f94cc2bf2022af378bef6dd38cc8b082e9b0cef8a93c31567c422c6267adf27b842f7f3e263ce1f12f9a41c3afeb837ece971167f35018c00adde97e74c6dbc34fcef73c8bde5b094588e9c7ad95a829fec640a319982e4b9083268fbb6835b1aa78c08da029214b707f57c1ca6053cc1d460fa6c243100639eece2706b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Please enter password to read</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Please enter password to read</summary>
    
    
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
    <category term="Bug" scheme="http://example.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>busuanzi&amp;live2d bug</title>
    <link href="http://example.com/2022/05/09/%E4%B8%8D%E8%92%9C%E5%AD%90&amp;%E7%9C%8B%E6%9D%BF%E5%96%B5bug/"/>
    <id>http://example.com/2022/05/09/%E4%B8%8D%E8%92%9C%E5%AD%90&amp;%E7%9C%8B%E6%9D%BF%E5%96%B5bug/</id>
    <published>2022-05-09T00:48:00.000Z</published>
    <updated>2022-05-14T01:27:54.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="bug引入"><a href="#bug引入" class="headerlink" title="bug引入"></a>bug引入</h2><p> 在已经使用不蒜子插件实现流量统计的Hexo博客中对页面进一步美化时，加入live2d看板娘导致不蒜子失效。实践发现启动live2d插件功能时（即配置文件中<code>enable: true</code>），不蒜子失效，关闭插件（<code>enable: false</code>），不蒜子功能正常。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#看板喵</span><br><span class="line">live2d:</span><br><span class="line">  enable: true  #是否启用live2d</span><br><span class="line">  scriptFrom: local</span><br><span class="line">  model: </span><br><span class="line">    use: live2d-widget-model-hijiki #模型选择</span><br><span class="line">  display: </span><br><span class="line">    position: left   </span><br><span class="line">    width: 140       </span><br><span class="line">    height: 280      </span><br><span class="line">  mobile: </span><br><span class="line">    show: false      </span><br></pre></td></tr></table></figure><h2 id="解决bug"><a href="#解决bug" class="headerlink" title="解决bug"></a>解决bug</h2><p>①：分别对不蒜子功能正常和非正常状态下的页面代码进行分析，发现不蒜子失效时的代码中显示<code>style=&quot;display: none;&quot;</code>，</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/blog/14.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>而关闭 live2d 插件后正常状态下是<code>style=&quot;display: inline;&quot;</code>，如下图：</p><img src='https://cdn.jsdelivr.net/gh/SoulChay/figureBed@master/blog/15.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>②：查看自己添加的不蒜子代码，本人添加代码的位置为 <code>themes\cactus\layout\_partial\footer.ejs</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 不蒜子统计访问量 --&gt;</span></span><br><span class="line">&lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入不蒜子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>在网页中直接打开我们引入的js，得到实现代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bszCaller,bszTag;!<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> c,d,e,a=!<span class="number">1</span>,b=[];ready=<span class="keyword">function</span>(<span class="params">c</span>)&#123;<span class="keyword">return</span> a||<span class="string">&quot;interactive&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>||<span class="string">&quot;complete&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>?c.<span class="title function_">call</span>(<span class="variable language_">document</span>):b.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> c.<span class="title function_">call</span>(<span class="variable language_">this</span>)&#125;),<span class="variable language_">this</span>&#125;,d=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="number">0</span>,c=b.<span class="property">length</span>;c&gt;a;a++)b[a].<span class="title function_">apply</span>(<span class="variable language_">document</span>);b=[]&#125;,e=<span class="keyword">function</span>(<span class="params"></span>)&#123;a||(a=!<span class="number">0</span>,d.<span class="title function_">call</span>(<span class="variable language_">window</span>),<span class="variable language_">document</span>.<span class="property">removeEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">detachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,e),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(<span class="built_in">clearInterval</span>(c),c=<span class="literal">null</span>)))&#125;,<span class="variable language_">document</span>.<span class="property">addEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="regexp">/loaded|complete/</span>.<span class="title function_">test</span>(<span class="variable language_">document</span>.<span class="property">readyState</span>)&amp;&amp;<span class="title function_">e</span>()&#125;),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(c=<span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;a||<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">&quot;left&quot;</span>)&#125;<span class="keyword">catch</span>(b)&#123;<span class="keyword">return</span>&#125;<span class="title function_">e</span>()&#125;,<span class="number">5</span>)))&#125;(),bszCaller=&#123;<span class="attr">fetch</span>:<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="keyword">var</span> c=<span class="string">&quot;BusuanziCallback_&quot;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1099511627776</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>());<span class="variable language_">window</span>[c]=<span class="variable language_">this</span>.evalCall(b),a=a.<span class="title function_">replace</span>(<span class="string">&quot;=BusuanziCallback&quot;</span>,<span class="string">&quot;=&quot;</span>+c),scriptTag=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;SCRIPT&quot;</span>),scriptTag.<span class="property">type</span>=<span class="string">&quot;text/javascript&quot;</span>,scriptTag.<span class="property">defer</span>=!<span class="number">0</span>,scriptTag.<span class="property">src</span>=a,scriptTag.<span class="property">referrerPolicy</span>=<span class="string">&quot;no-referrer-when-downgrade&quot;</span>,<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;HEAD&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(scriptTag)&#125;,<span class="attr">evalCall</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;<span class="title function_">a</span>(b),scriptTag.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(scriptTag)&#125;<span class="keyword">catch</span>(c)&#123;bszTag.<span class="title function_">hides</span>()&#125;&#125;)&#125;&#125;&#125;,bszCaller.<span class="title function_">fetch</span>(<span class="string">&quot;//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback&quot;</span>,<span class="keyword">function</span>(<span class="params">a</span>)&#123;bszTag.<span class="title function_">texts</span>(a),bszTag.<span class="title function_">shows</span>()&#125;),bszTag=&#123;<span class="attr">bszs</span>:[<span class="string">&quot;site_pv&quot;</span>,<span class="string">&quot;page_pv&quot;</span>,<span class="string">&quot;site_uv&quot;</span>],<span class="attr">texts</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="keyword">var</span> c=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_value_&quot;</span>+b);c&amp;&amp;(c.<span class="property">innerHTML</span>=a[b])&#125;)&#125;,<span class="attr">hides</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;none&quot;</span>)&#125;)&#125;,<span class="attr">shows</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>)&#125;)&#125;&#125;;</span><br></pre></td></tr></table></figure><p>③：而解决方法也很简单，首先是将不蒜子的js插件保存到本地。这个位置很重要，后面需要引入这个位置的js文件。</p><p>在我的主题中位于<code>\themes\cactus\source\lib\busuanzi\busuanzi.pure.mini.js</code>。</p><p>将js文件更改为如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bszCaller,bszTag;!<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> c,d,e,a=!<span class="number">1</span>,b=[];ready=<span class="keyword">function</span>(<span class="params">c</span>)&#123;<span class="keyword">return</span> a||<span class="string">&quot;interactive&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>||<span class="string">&quot;complete&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>?c.<span class="title function_">call</span>(<span class="variable language_">document</span>):b.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> c.<span class="title function_">call</span>(<span class="variable language_">this</span>)&#125;),<span class="variable language_">this</span>&#125;,d=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="number">0</span>,c=b.<span class="property">length</span>;c&gt;a;a++)b[a].<span class="title function_">apply</span>(<span class="variable language_">document</span>);b=[]&#125;,e=<span class="keyword">function</span>(<span class="params"></span>)&#123;a||(a=!<span class="number">0</span>,d.<span class="title function_">call</span>(<span class="variable language_">window</span>),<span class="variable language_">document</span>.<span class="property">removeEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">detachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,e),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(<span class="built_in">clearInterval</span>(c),c=<span class="literal">null</span>)))&#125;,<span class="variable language_">document</span>.<span class="property">addEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="regexp">/loaded|complete/</span>.<span class="title function_">test</span>(<span class="variable language_">document</span>.<span class="property">readyState</span>)&amp;&amp;<span class="title function_">e</span>()&#125;),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(c=<span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;a||<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">&quot;left&quot;</span>)&#125;<span class="keyword">catch</span>(b)&#123;<span class="keyword">return</span>&#125;<span class="title function_">e</span>()&#125;,<span class="number">5</span>)))&#125;(),bszCaller=&#123;<span class="attr">fetch</span>:<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="keyword">var</span> c=<span class="string">&quot;BusuanziCallback_&quot;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1099511627776</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>());<span class="variable language_">window</span>[c]=<span class="variable language_">this</span>.evalCall(b),a=a.<span class="title function_">replace</span>(<span class="string">&quot;=BusuanziCallback&quot;</span>,<span class="string">&quot;=&quot;</span>+c),scriptTag=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;SCRIPT&quot;</span>),scriptTag.<span class="property">type</span>=<span class="string">&quot;text/javascript&quot;</span>,scriptTag.<span class="property">defer</span>=!<span class="number">0</span>,scriptTag.<span class="property">src</span>=a,<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;HEAD&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(scriptTag)&#125;,<span class="attr">evalCall</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;<span class="title function_">a</span>(b),scriptTag.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(scriptTag)&#125;<span class="keyword">catch</span>(c)&#123;bszTag.<span class="title function_">hides</span>()&#125;&#125;)&#125;&#125;&#125;,bszCaller.<span class="title function_">fetch</span>(<span class="string">&quot;//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback&quot;</span>,<span class="keyword">function</span>(<span class="params">a</span>)&#123;bszTag.<span class="title function_">texts</span>(a),bszTag.<span class="title function_">shows</span>()&#125;),bszTag=&#123;<span class="attr">bszs</span>:[<span class="string">&quot;site_pv&quot;</span>,<span class="string">&quot;page_pv&quot;</span>,<span class="string">&quot;site_uv&quot;</span>],<span class="attr">texts</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="keyword">var</span> c=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_value_&quot;</span>+b);c&amp;&amp;(c.<span class="property">innerHTML</span>=a[b])&#125;)&#125;,<span class="attr">hides</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;&quot;</span>)&#125;)&#125;,<span class="attr">shows</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>)&#125;)&#125;&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>操作其实就是把其中的<b><code>b.style.display=&quot;none&quot;</code>中<code>none</code></b>去掉。</p><p>④：然后到 添加的不蒜子代码的位置 修改代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 不蒜子统计访问量 --&gt;</span></span><br><span class="line">&lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入不蒜子(路径修改为自己下载js的地址)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/lib/busuanzi/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>⑤：可参考本人footer.ejs 全部代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 网站运行时间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timeDate&quot;</span>&gt;</span>载入天数...<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;times&quot;</span>&gt;</span>载入时分秒...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>(); </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">createtime</span>(<span class="params"></span>) &#123; </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> grt= <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;05/06/2022 22:38:00&quot;</span>);<span class="comment">//建站时间 格式：月/日/年 时:分:秒</span></span></span><br><span class="line"><span class="language-javascript">                now.<span class="title function_">setTime</span>(now.<span class="title function_">getTime</span>()+<span class="number">250</span>); </span></span><br><span class="line"><span class="language-javascript">                days = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>; dnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(days); </span></span><br><span class="line"><span class="language-javascript">                hours = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> - (<span class="number">24</span> * dnum); hnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(hours); </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(<span class="title class_">String</span>(hnum).<span class="property">length</span> ==<span class="number">1</span> )&#123;hnum = <span class="string">&quot;0&quot;</span> + hnum;&#125; minutes = (now - grt ) / <span class="number">1000</span> /<span class="number">60</span> - (<span class="number">24</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * hnum); </span></span><br><span class="line"><span class="language-javascript">                mnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(minutes); <span class="keyword">if</span>(<span class="title class_">String</span>(mnum).<span class="property">length</span> ==<span class="number">1</span> )&#123;mnum = <span class="string">&quot;0&quot;</span> + mnum;&#125; </span></span><br><span class="line"><span class="language-javascript">                seconds = (now - grt ) / <span class="number">1000</span> - (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * <span class="number">60</span> * hnum) - (<span class="number">60</span> * mnum); </span></span><br><span class="line"><span class="language-javascript">                snum = <span class="title class_">Math</span>.<span class="title function_">round</span>(seconds); <span class="keyword">if</span>(<span class="title class_">String</span>(snum).<span class="property">length</span> ==<span class="number">1</span> )&#123;snum = <span class="string">&quot;0&quot;</span> + snum;&#125; </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;timeDate&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;has been running for &quot;</span>+dnum+<span class="string">&quot; d &quot;</span>; </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;times&quot;</span>).<span class="property">innerHTML</span> = hnum + <span class="string">&quot; h &quot;</span> + mnum + <span class="string">&quot; m &quot;</span> + snum + <span class="string">&quot; s&quot;</span>; </span></span><br><span class="line"><span class="language-javascript">            &#125; </span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setInterval</span>(<span class="string">&quot;createtime()&quot;</span>,<span class="number">250</span>);</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 版权年份 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          &lt;%= __(&#x27;footer.copyright&#x27;) %&gt; <span class="symbol">&amp;copy;</span></span><br><span class="line">          &lt;% var endYear = (theme.copyright &amp;&amp; theme.copyright.end_year) ? theme.copyright.end_year : new Date().getFullYear() %&gt;</span><br><span class="line">          &lt;% var startYear = (theme.copyright &amp;&amp; theme.copyright.start_year) ? theme.copyright.start_year : new Date().getFullYear() %&gt;</span><br><span class="line">          &lt;%= startYear &gt;= endYear ? endYear : startYear + &quot;-&quot; + endYear %&gt;</span><br><span class="line">          &lt;%= config.author || config.title %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;% for (var i in theme.nav) &#123; %&gt;<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">          --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(theme.nav[i]) %&gt;&quot;</span>&gt;</span>&lt;%= __(&#x27;nav.&#x27;+i).replace(&quot;nav.&quot;, &quot;&quot;) %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        --&gt;</span>&lt;% &#125; %&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">          <span class="comment">&lt;!-- 不蒜子统计访问量 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span>     </span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/lib/busuanzi/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            &lt;% &#125; %&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><p>问题解决。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;bug引入&quot;&gt;&lt;a href=&quot;#bug引入&quot; class=&quot;headerlink&quot; title=&quot;bug引入&quot;&gt;&lt;/a&gt;bug引入&lt;/h2&gt;&lt;p&gt; 在已经使用不蒜子插件实现流量统计的Hexo博客中对页面进一步美化时，加入live2d看板娘导致不蒜子失效。实践发现</summary>
      
    
    
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
    <category term="Bug" scheme="http://example.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>向上转型问题</title>
    <link href="http://example.com/2021/07/09/%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B%E9%97%AE%E9%A2%98/"/>
    <id>http://example.com/2021/07/09/%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B%E9%97%AE%E9%A2%98/</id>
    <published>2021-07-09T07:08:00.000Z</published>
    <updated>2022-05-14T01:08:30.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="抛出问题"><a href="#抛出问题" class="headerlink" title="抛出问题"></a>抛出问题</h2><p>先来看一个代码示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Int2LongOverflow</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Integer.MAX_VALUE = 2147483647</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum1</span> <span class="operator">=</span> a + b1;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum2</span> <span class="operator">=</span> <span class="number">2147483647</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">b2</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum3</span> <span class="operator">=</span> a + b2;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum4</span> <span class="operator">=</span> <span class="number">2147483647</span> + <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;sum1 = &quot;</span> + sum1);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum2 = &quot;</span> + sum2);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum3 = &quot;</span> + sum3);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum4 = &quot;</span> + sum4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思索一下，是不是sum1, sum2, sum3, sum4均输出2147483648呢？</p><p>下面是代码运行结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sum1 = -<span class="number">2147483648</span></span><br><span class="line">sum2 = -<span class="number">2147483648</span></span><br><span class="line">sum3 = <span class="number">2147483648</span></span><br><span class="line">sum4 = <span class="number">2147483648</span></span><br></pre></td></tr></table></figure><h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>看似sum1, sum2, sum3, sum4均计算2147483647 + 1的结果，并且结果用 <b>long</b> 类型接收，但为什么会有两种不同计算结果呢？</p><ol><li>sum1计算的是a + b1，其中a和b1均为int类型数据。计算顺序是这样的：首先取表达式中最大的类型暂存计算结果，也就是int类型暂存a + b1的结果，显然会发生溢出，暂存的结果就为-2147483648；然后再将暂存的结果赋值给sum1，其中会向上隐式转型，于是sum1 &#x3D; -2147483648。</li><li>sum2计算的是两个字面量值的和。在Java中，纯数字字面量默认类型为int（在整数后加L表示long类型，例如12L表示long类型的12），因此，sum2的计算效果同sum1。</li><li>sum3与sum1唯一的区别就是，其中b2的类型变为long（值保持不变）。因此在计算时，会将a向上转型为long，再做long类型之间的运算，运算结果为long类型，最后再赋值给sum3。这一系列操作自然不会发生溢出。</li><li>sum4表达式中的字面量1L为long类型，计算效果同sum3，不会发生溢出。</li></ol><h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><p>在Java中，如果赋值语句的右边是表达式，可以将该语句看成三个执行过程。</p><ol><li>将表达式中所有变量或字面量隐式向上转型为其中的最大类型；</li><li>用计算式中的最大类型暂存计算结果；</li><li>将暂存的结果赋值给左侧变量，如果暂存类型与左侧变量类型不一致，需要做显式（向下转型）或隐式（向上转型）的类型转换。</li></ol><p>转自：<a href="https://blog.csdn.net/huwei1844352682/article/details/106632488">https://blog.csdn.net/huwei1844352682/article/details/106632488</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;抛出问题&quot;&gt;&lt;a href=&quot;#抛出问题&quot; class=&quot;headerlink&quot; title=&quot;抛出问题&quot;&gt;&lt;/a&gt;抛出问题&lt;/h2&gt;&lt;p&gt;先来看一个代码示例：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td c</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
  </entry>
  
</feed>
